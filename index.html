<!DOCTYPE html>
<html lang="en">
<head>
  <!-- [Previous head content remains exactly the same] -->
</head>
<body>
  <!-- [Previous HTML structure remains exactly the same] -->

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Initialize empty data store
    const dataStore = {
      users: [
        { username: 'admin', password: 'admin123', role: 'admin', name: 'System Admin' },
        { username: 'manager', password: 'manager123', role: 'team_manager', name: 'John Smith' },
        { username: 'headcoach', password: 'coach123', role: 'head_coach', name: 'Emma Johnson' },
        { username: 'physio', password: 'physio123', role: 'physio', name: 'Michael Brown' },
        { username: 'gk1', password: 'player123', role: 'player', name: 'Carlos Mendez' },
        { username: 'def1', password: 'player123', role: 'player', name: 'James Wilson' }
      ],
      players: [],
      exercises: {},
      medicalRecords: [],
      crutches: [],
      inventory: []
    };

    // [Previous DOM elements and app state declarations remain the same]

    async function checkForDefaultGist() {
      // Check if there's a default Gist ID in localStorage
      const defaultGistId = localStorage.getItem('defaultGistId');
      if (defaultGistId && currentUser?.role === 'admin') {
        elements.gistId.value = defaultGistId;
        await loadDataFromGist();
      }
    }

    async function loadDataFromGist() {
      const gistId = elements.gistId.value.trim();
      const token = elements.githubToken.value.trim();
      
      if (!gistId) {
        showGitHubStatus('Please enter a Gist ID', 'error');
        return;
      }
      
      try {
        showGitHubStatus('Loading data from Gist...', 'info');
        
        const gistResponse = await fetch(`https://api.github.com/gists/${gistId}`, {
          headers: token ? {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          } : {
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (!gistResponse.ok) {
          throw new Error(`Failed to fetch Gist: ${gistResponse.status}`);
        }
        
        const gist = await gistResponse.json();
        const jsonFile = Object.values(gist.files).find(f => f.filename.endsWith('.json'));
        
        if (!jsonFile) {
          throw new Error('No JSON data file found in Gist');
        }
        
        const contentResponse = await fetch(jsonFile.raw_url);
        const parsedData = JSON.parse(await contentResponse.text());

        // Validate and merge data
        for (const key in parsedData) {
          if (dataStore.hasOwnProperty(key)) {
            dataStore[key] = parsedData[key];
          }
        }

        // Save as default Gist if admin
        if (currentUser?.role === 'admin') {
          localStorage.setItem('defaultGistId', gistId);
        }

        // Refresh all UI
        loadInitialData();
        showGitHubStatus('Data loaded successfully!', 'success');
        
      } catch (error) {
        showGitHubStatus(`Error: ${error.message}`, 'error');
        console.error('Gist load error:', error);
        
        // Show empty state messages if no data exists
        if (dataStore.players.length === 0) {
          showEmptyStateMessages();
        }
      }
    }

    function showEmptyStateMessages() {
      // Players tab
      if (elements.playerTable) {
        elements.playerTable.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: 20px;">
              No players found. ${currentUser?.role === 'admin' ? 
                'Please load data from GitHub Gist or add players manually.' : 
                'Please contact your administrator.'}
            </td>
          </tr>`;
      }

      // Other tabs
      const emptyMessage = currentUser?.role === 'admin' ? 
        'No data available. Please load from GitHub Gist.' : 
        'No data available. Please contact your administrator.';

      if (elements.trainingContent) {
        elements.trainingContent.innerHTML = `<p>${emptyMessage}</p>`;
      }
      if (elements.medicalContent) {
        elements.medicalContent.innerHTML = `<p>${emptyMessage}</p>`;
      }
      if (elements.crutchesContent) {
        elements.crutchesContent.innerHTML = `<p>${emptyMessage}</p>`;
      }
      if (elements.inventoryContent) {
        elements.inventoryContent.innerHTML = `<p>${emptyMessage}</p>`;
      }
    }

    function handleLogin(event) {
      event.preventDefault();
      
      const username = elements.username.value.trim();
      const password = elements.password.value.trim();
      const user = dataStore.users.find(u => u.username === username && u.password === password);

      if (user) {
        currentUser = user;
        elements.loginOverlay.style.display = 'none';
        elements.appContent.style.display = 'block';
        elements.welcomeHeader.textContent = `Welcome, ${user.name || user.username}`;
        
        // Show/hide tabs based on role
        document.querySelectorAll('.tab-btn').forEach(tab => {
          const tabId = tab.dataset.tab;
          
          if (tabId === 'githubSync') {
            tab.style.display = currentUser.role === 'admin' ? 'block' : 'none';
          } else if (tabId === 'athleteDashboard') {
            tab.style.display = currentUser.role === 'player' ? 'block' : 'none';
          } else {
            tab.style.display = ['admin', 'team_manager', 'head_coach', 'physio'].includes(currentUser.role) ? 'block' : 'none';
          }
        });
        
        loadInitialData();
        
        // If admin, check for default Gist
        if (currentUser.role === 'admin') {
          checkForDefaultGist();
        }
      } else {
        alert('Invalid username or password');
      }
    }

    // [Rest of the functions remain the same, but remove all hardcoded data references]

    function init() {
      setupEventListeners();
      elements.loginOverlay.style.display = 'flex';
      elements.appContent.style.display = 'none';
      
      // Check if we have a default Gist ID in URL hash
      if (window.location.hash) {
        const gistId = window.location.hash.substring(1);
        if (gistId) {
          localStorage.setItem('defaultGistId', gistId);
        }
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
