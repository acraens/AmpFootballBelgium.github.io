<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AFPRS - Amputee Football</title>
  <style>
    /* Previous CSS styles remain exactly the same */
    /* Add this new style for the recovery link */
    .recovery-link {
      text-align: center;
      margin-top: 15px;
      color: var(--primary);
      cursor: pointer;
      text-decoration: underline;
    }
    #recoveryOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }
    .recovery-box {
      background: white;
      padding: 30px;
      border-radius: 8px;
      width: 100%;
      max-width: 400px;
    }
  </style>
</head>
<body>
  <!-- Previous HTML remains the same until the login box -->
  <div class="login-box">
    <h1>AFPRS Login</h1>
    <form id="loginForm">
      <div class="form-group">
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Username" required>
      </div>
      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Password" required>
      </div>
      <button type="submit">Login</button>
    </form>
    <div class="recovery-link" id="forgotPassword">Forgot password?</div>
    <!-- Rest of the login box content -->
  </div>

  <!-- Add this new recovery overlay -->
  <div id="recoveryOverlay">
    <div class="recovery-box">
      <h2>Password Recovery</h2>
      <div class="form-group">
        <label for="recoveryUsername">Username:</label>
        <input type="text" id="recoveryUsername" placeholder="Enter your username">
      </div>
      <div class="form-group">
        <label for="recoveryEmail">Registered Email:</label>
        <input type="email" id="recoveryEmail" placeholder="Enter your email">
      </div>
      <button id="submitRecovery">Recover Password</button>
      <div id="recoveryStatus" class="status-message" style="margin-top:15px;"></div>
      <button id="closeRecovery" style="margin-top:15px;background:var(--danger)">Close</button>
    </div>
  </div>

  <!-- Rest of the HTML remains the same -->

  <script>
    // Previous JavaScript remains the same until the handleLogin function

    function handleLogin(event) {
      event.preventDefault();
      
      const username = elements.username.value.trim();
      const password = elements.password.value.trim();
      const user = dataStore.users.find(u => u.username === username && u.password === password);

      if (user) {
        currentUser = user;
        elements.loginOverlay.style.display = 'none';
        elements.appContent.style.display = 'block';
        elements.welcomeHeader.textContent = `Welcome, ${user.name || user.username}`;
        
        document.querySelectorAll('.tab-btn').forEach(tab => {
          const tabId = tab.dataset.tab;
          tab.style.display = 'none';
          
          switch(currentUser.role) {
            case 'admin':
              if (tabId !== 'athleteDashboard' || tabId === 'githubSync') {
                tab.style.display = 'block';
              }
              break;
            case 'team_manager':
              if (['dashboard', 'players', 'training', 'medical', 'crutches', 'inventory'].includes(tabId)) {
                tab.style.display = 'block';
              }
              break;
            case 'head_coach':
              if (['dashboard', 'players', 'training'].includes(tabId)) {
                tab.style.display = 'block';
              }
              break;
            case 'physio':
              if (['dashboard', 'players', 'medical'].includes(tabId)) {
                tab.style.display = 'block';
              }
              break;
            case 'player':
              if (tabId === 'athleteDashboard') tab.style.display = 'block';
              break;
          }
        });
        
        // Force show githubSync for admin
        if (currentUser.role === 'admin') {
          document.querySelector('[data-tab="githubSync"]').style.display = 'block';
          const defaultGistId = localStorage.getItem('defaultGistId');
          if (defaultGistId) {
            elements.gistId.value = defaultGistId;
          }
        }
        
        loadInitialData();
      } else {
        alert('Invalid username or password');
      }
    }

    // Add these new recovery functions
    function handlePasswordRecovery() {
      const username = document.getElementById('recoveryUsername').value.trim();
      const email = document.getElementById('recoveryEmail').value.trim();
      const recoveryStatus = document.getElementById('recoveryStatus');
      
      if (!username || !email) {
        recoveryStatus.textContent = 'Please enter both username and email';
        recoveryStatus.className = 'status-message error';
        return;
      }
      
      // In a real system, you would send this to a server
      // For demo purposes, we'll check against our dataStore
      const user = dataStore.users.find(u => 
        u.username === username && 
        (u.email === email || email.endsWith('@example.com')) // Demo: any @example.com works
      
      if (user) {
        recoveryStatus.textContent = `Password recovery sent to ${email}. Demo password: ${user.password}`;
        recoveryStatus.className = 'status-message success';
      } else {
        recoveryStatus.textContent = 'No account found with those details';
        recoveryStatus.className = 'status-message error';
      }
    }

    function setupEventListeners() {
      // Previous event listeners remain the same
      
      // Add new recovery listeners
      document.getElementById('forgotPassword').addEventListener('click', () => {
        document.getElementById('recoveryOverlay').style.display = 'flex';
      });
      
      document.getElementById('submitRecovery').addEventListener('click', handlePasswordRecovery);
      
      document.getElementById('closeRecovery').addEventListener('click', () => {
        document.getElementById('recoveryOverlay').style.display = 'none';
      });
    }

    // Rest of the JavaScript remains the same
  </script>
</body>
</html>
